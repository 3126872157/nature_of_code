### 第五章 自主代理
#### 转向
+ 自主代理（agent）可以感知环境，根据自身策略得出一个内部动力
+ 转向力：desire(可以是自身指向目标的矢量，当然可以做一些处理，如限幅) 和 自身速度的差（一种误差）
+ 根据转向力，可以实现两种策略：追踪和逃离
+ 到达策略：闯进目标周围的圈内，速度根据距离进行0到最大值的映射
+ 转向力怎么给可以衍生出很多**不同策略**：
  + 游走：目标在自身前方的一个极坐标上随机变化角度
  + 墙：出了墙就往墙反方向走

#### 流场
+ 流场像是地铁站台地上的指示箭头，告诉代理应该往哪走（施加力）
+ 使用柏林噪声生成流场

#### 路径跟随
+ 路径是一条由起点和终点决定的线段，半径决定路径宽度
+ 目标是机体到线路最近点前面的一个点
+ 判断法向点有无落在线段上的方法：法向点到端点距离和是否大于端点间距离
+ 跟随的方法是查询代理到线段的距离是否超出半径，如果是就转向，这个转向力来自于垂线前端的一个点（目标）
+ 多路径：寻找最近的法向点，多路径路径对象可以涵盖非常多的点

#### 复杂系统
+ 复杂系统的三个原则
  + 简单单元间的短距离关系（不能全知）
  + 简单单元并行运行
  + 整个系统展现涌现
+ 系统特质
  + 非线性（混沌）
  + 竞争与合作（例如集群系统有：对齐、凝聚和分裂的规则）
  + 反馈（输出反过来影响输入）
+ 集群特点
  + 分离：遍历，检查距离，若太近则给斥力
  + 结合：遇上者相反
  + 力矢之和：可以通过不同力的**加权**，来达到不同效果
+ The Computational Beauty of Nature 中的新规则
  + view: “Move laterally away from any boid that blocks the view.”
  + 即是：横移去规避挡住视线的群落

#### 优化
+ 时间复杂度优化
  + 空间划分：使用格子划分屏幕
  + 四叉树（平面），八叉树（空间）
+ 其他减少CPU运算的优化
  + 保持平方（不要开方）
  + 创建正弦查找表（lut）
  + 不要创建不必要的对象（如临时对象等等）

#### TODO
+ [ ] 流场随时间变化（ 3D 的柏林噪声）
+ [ ] 使用图像创建流场
+ [ ] 路径随时间变化，不同点有不同转向行为
+ [ ] 加入分离力之后的众球寻路（同时存在 seek 和 separate）
+ [ ] separate 和 seek 的权值不同，有些人separate 大，有些 seek 大；或权值随 sin 波变化或 perlin 噪声变化
+ [ ] 加入随机种子初始化生成位置
+ [x] align 的目标变成扇形
+ [x] 不同权重、最大速度、最大力随时间变化
+ [ ] 权值不应该使用正弦函数控制，不能随机，要不然没意思，得跟团体数量挂钩
+ [x] 四叉树优化和优化技巧
+ [ ] 四叉树加上对象池
+ [ ] 加入车的小随机游走，反正现在看得很呆板